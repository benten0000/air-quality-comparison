seed: 42

data:
  data_dir: data/raw
  stations:
  - E403
  - E404
  - E405
  - E407
  - E408
  - E409
  - E410
  - E411
  - E412
  - E413
  - E414
  - E415
  - E417
  - E418
  - E420
  - E421
  - E423
  - E801
  - E802
  - E803
  - E804
  #- all_stations
  # Optional JSON with station coordinates (for HybridLocLSTM).
  station_geo_path: configs/pipeline/stations_geo.json
  datetime_col: datetime
  features:
  - station
  - PM10
  - PM2.5
  - temperature
  - rain
  - pressure
  - precipitation
  - wind_speed
  - clouds
  - wind_direction
  target_features:
  - PM10
  - PM2.5
  - temperature
  - rain
  - pressure
  - precipitation
  - wind_speed
  - clouds
  - wind_direction
experiment:
  common:
    # Forecast windowing.
    history_length: 24
    forecast_horizon: 1
    step_size: 1

    # Model families to compare.
    models:
    - transformer
    - lstm
    - gru
    - hybrid_loclstm

  standard:
    run: true
    # Share of full timeline used for validation.
    val_ratio: 0.1
    # Share of full timeline used for train.
    train_ratio: 0.7
    # Share of full timeline used for test.
    test_ratio: 0.2

  five_fold:
    run: true
    n_folds: 5
    # For 20% of stations in each fold, drop the first N months from training
    # to simulate shorter history availability (mentor spec).
    missing_months: 6

metrics:
  # MAPE is unstable near zero targets (rain etc.). Keep epsilon for zero-filtering
  # and floor the denominator for small non-zero values.
  mape_eps: 0.000001
  mape_min_abs_target: 1.0

models:
  transformer:
    type: transformer
    runtime:
      bias: true
      use_torch_compile: true
      compile_mode: reduce-overhead
      compile_dynamic: false

      optimizer_lr: 0.0002 #0.000005
      optimizer_fused: true
      optimizer_weight_decay: 0.01

      scheduler_warmup_ratio: 0.08
      scheduler_warmup_start_factor: 0.3
      scheduler_min_lr: 0.0000001

      grad_clip_norm: 1.0

      dataloader_num_workers: -1
      dataloader_prefetch_factor: 4
      dataloader_persistent_workers: true
      dataloader_pin_memory: true

    params:
      # Fair baseline: medium-size transformer.
      d_model: 128
      n_layer: 2
      n_head: 4
      d_ffn: 256
      d_k:
      d_v:
      dropout: 0.2
      norm_eps: 0.000001


  lstm:
    type: lstm
    runtime:
      bias: true
      use_torch_compile: true
      compile_mode: reduce-overhead
      compile_dynamic: false
      optimizer_lr: 0.0001 #0.000005
      optimizer_fused: true
      optimizer_weight_decay: 0.02
      scheduler_warmup_ratio: 0.125
      scheduler_warmup_start_factor: 0.3
      scheduler_min_lr: 0.0000001
      grad_clip_norm: 1.0
      dataloader_num_workers: -1
      dataloader_prefetch_factor: 4
      dataloader_persistent_workers: true
      dataloader_pin_memory: true
    params:
      # Fair baseline: same hidden width/depth as other recurrent models.
      hidden_size: 128
      num_layers: 2
      dropout: 0.25

  gru:
    type: gru
    runtime:
      bias: true
      use_torch_compile: true
      compile_mode: reduce-overhead
      compile_dynamic: false
      optimizer_lr: 0.0001 #0.000005
      optimizer_fused: true
      optimizer_weight_decay: 0.02
      scheduler_warmup_ratio: 0.125
      scheduler_warmup_start_factor: 0.3
      scheduler_min_lr: 0.0000001
      grad_clip_norm: 0.5
      dataloader_num_workers: -1
      dataloader_prefetch_factor: 4
      dataloader_persistent_workers: true
      dataloader_pin_memory: true
    params:
      hidden_size: 128
      num_layers: 2
      dropout: 0.25

  hybrid_loclstm:
    type: hybrid_loclstm
    runtime:
      bias: true
      use_torch_compile: true
      compile_mode: reduce-overhead
      compile_dynamic: false
      optimizer_lr: 0.0001 #0.000005
      optimizer_fused: true
      optimizer_weight_decay: 0.02
      scheduler_warmup_ratio: 0.125
      scheduler_warmup_start_factor: 0.3
      scheduler_min_lr: 0.0000001
      grad_clip_norm: 0.5
      dataloader_num_workers: -1
      dataloader_prefetch_factor: 4
      dataloader_persistent_workers: true
      dataloader_pin_memory: true
    params:
      hidden_size: 128
      num_layers: 2
      dropout: 0.25
      embed_dim: 16
      geo_dim: 2
      station_feature_index: 0

training:
  device: auto
  epochs: 80
  # Server throughput profile (RTX 6000 class): start higher, reduce only if OOM.
  batch_size: 4096

  early_stopping: true
  patience: 20
  min_delta: 0.0
  # Lower logging overhead during long runs.
  log_every: 5

paths:
  reports_dir: reports/forecast_experiments
  models_dir: artifacts/models/forecast_experiments
  metrics_path: reports/metrics/forecast_metrics.json

output:
  save_models: false

tracking:
  enabled: true
  experiment: air-quality-missing-data-imputation
  experiment_standard: comperosion-normal
  experiment_five_fold: comperosion-5fold
  dataset_name: air_quality
  repo_owner: PetelinekBenjamin
  repo_name: air-quality-comparison
  tracking_uri: https://dagshub.com/PetelinekBenjamin/air-quality-comparison.mlflow
